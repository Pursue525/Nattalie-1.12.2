package net.pursue.mode.exploit;

import com.mojang.authlib.GameProfile;
import net.minecraft.client.entity.EntityOtherPlayerMP;
import net.minecraft.potion.PotionEffect;
import net.pursue.mode.Mode;
import net.pursue.utils.category.Category;

import java.util.UUID;

public class FakePlayer extends Mode {
    public FakePlayer() {
        super("FakePlayer", "假玩家", "生存一个虚假的玩家", Category.EXPLOIT);
    }

    private EntityOtherPlayerMP blinkEntity;

    @Override
    public void enable() {

        if (mc.player == null) return;

        addEntity();
    }

    @Override
    public void disable() {
        if (mc.player == null || this.blinkEntity == null) return;

        delEntity();
    }

    private void addEntity() {
        this.blinkEntity = new EntityOtherPlayerMP(mc.world, new GameProfile(new UUID(69L, 96L), mc.player.getName()));
        this.blinkEntity.inventory = mc.player.inventory;
        this.blinkEntity.inventoryContainer = mc.player.inventoryContainer;
        this.blinkEntity.setPositionAndRotation(mc.player.posX, mc.player.posY, mc.player.posZ, mc.player.rotationYaw, mc.player.rotationPitch);

        if (!mc.player.getActivePotionEffects().isEmpty()) {

            for (PotionEffect pot : mc.player.getActivePotionEffects()) {
                this.blinkEntity.addPotionEffect(pot);
            }
        }
        this.blinkEntity.rotationYaw = mc.player.rotationYaw;
        this.blinkEntity.rotationPitch = mc.player.rotationPitch;
        this.blinkEntity.rotationYawHead = mc.player.rotationYawHead;
        this.blinkEntity.renderYawOffset = mc.player.renderYawOffset;
        this.blinkEntity.setSneaking(mc.player.isSneaking());
        mc.world.addEntityToWorld(this.blinkEntity.getEntityId(), this.blinkEntity);
    }

    private void delEntity() {
        mc.world.removeEntityFromWorld(this.blinkEntity.getEntityId());
    }
}
